{"version":3,"sources":["polymer/analyze-properties.ts"],"names":[],"mappings":"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","file":"analyze-properties.js","sourcesContent":["/**\n * @license\n * Copyright (c) 2015 The Polymer Project Authors. All rights reserved.\n * This code may only be used under the BSD style license found at\n * http://polymer.github.io/LICENSE.txt\n * The complete set of authors may be found at\n * http://polymer.github.io/AUTHORS.txt\n * The complete set of contributors may be found at\n * http://polymer.github.io/CONTRIBUTORS.txt\n * Code distributed by Google as part of the polymer project is also\n * subject to an additional IP rights grant found at\n * http://polymer.github.io/PATENTS.txt\n */\n\nimport * as estree from 'estree';\n\nimport * as astValue from '../javascript/ast-value';\nimport * as esutil from '../javascript/esutil';\nimport {JavaScriptDocument} from '../javascript/javascript-document';\nimport {ScannedProperty} from '../model/model';\nimport {Severity} from '../warning/warning';\n\nimport {toScannedPolymerProperty} from './js-utils';\n\nexport function analyzeProperties(\n    node: estree.Node, document: JavaScriptDocument) {\n  const analyzedProps: ScannedProperty[] = [];\n\n  if (node.type !== 'ObjectExpression') {\n    return analyzedProps;\n  }\n\n  for (const property of node.properties) {\n    const prop = toScannedPolymerProperty(\n        property, document.sourceRangeForNode(property)!);\n    prop.published = true;\n\n    let isComputed = false;\n\n    if (property.value.type === 'Identifier') {\n      prop.type = property.value.name;\n    } else if (property.value.type !== 'ObjectExpression') {\n      continue;\n    } else {\n      /**\n       * Parse the expression inside a property object block. e.g.\n       * property: {\n       *   key: {\n       *     type: String,\n       *     notify: true,\n       *     value: -1,\n       *     readOnly: true,\n       *     reflectToAttribute: true\n       *   }\n       * }\n       */\n      for (const propertyArg of property.value.properties) {\n        const propertyKey = esutil.objectKeyToString(propertyArg.key);\n\n        switch (propertyKey) {\n          case 'type':\n            prop.type = esutil.objectKeyToString(propertyArg.value);\n            if (prop.type === undefined) {\n              prop.warnings.push({\n                code: 'invalid-property-type',\n                message: 'Invalid type in property object.',\n                severity: Severity.ERROR,\n                sourceRange: document.sourceRangeForNode(propertyArg)!\n              });\n            }\n            break;\n          case 'notify':\n            prop.notify = !!astValue.expressionToValue(propertyArg.value);\n            break;\n          case 'observer':\n            const val = astValue.expressionToValue(propertyArg.value);\n            prop.observerNode = propertyArg.value;\n            if (val === undefined) {\n              prop.observer = astValue.CANT_CONVERT;\n            } else {\n              prop.observer = JSON.stringify(val);\n            }\n            break;\n          case 'readOnly':\n            prop.readOnly = !!astValue.expressionToValue(propertyArg.value);\n            break;\n          case 'reflectToAttribute':\n            prop.reflectToAttribute = !!astValue.expressionToValue(propertyArg);\n            break;\n          case 'computed':\n            isComputed = true;\n            break;\n          case 'value':\n            prop.default =\n                JSON.stringify(astValue.expressionToValue(propertyArg.value));\n            break;\n          default:\n            break;\n        }\n      }\n    }\n\n    if (isComputed) {\n      prop.readOnly = true;\n    }\n\n    prop.type = esutil.CLOSURE_CONSTRUCTOR_MAP[prop.type!] || prop.type;\n\n    if (!prop.type) {\n      prop.warnings.push({\n        code: 'no-type-for-property',\n        message: 'Unable to determine type for property.',\n        severity: Severity.WARNING,\n        sourceRange: document.sourceRangeForNode(property)!\n      });\n    }\n\n    analyzedProps.push(prop);\n  }\n  return analyzedProps;\n};\n"]}